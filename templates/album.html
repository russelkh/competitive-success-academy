<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CSA School Album</title>
  <style>
    /* --- General Body --- */
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background: url('/static/images/background-image for album.png') no-repeat center center;
  background-size: cover;
  background-attachment: fixed;
  overflow-x: hidden;
  color: #333;
  position: relative;
  touch-action: pan-y; /* allows swipe gestures on mobile */
}

/* White overlay for readability */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(255, 255, 255, 0.7);
  z-index: -1;
}

/* --- Back Button --- */
.back-btn {
  position: fixed;
  top: 20px;
  left: 20px;
  padding: 10px 20px;
  font-size: 18px;
  font-weight: bold;
  color: #fff;
  background-color: #A51C30;
  border-radius: 30px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  text-decoration: none;
  z-index: 10;
  transition: transform 0.3s, background-color 0.3s;
}
.back-btn:hover {
  background-color: #911625;
  transform: scale(1.05);
}

/* --- Logo --- */
.logo {
  text-align: center;
  padding: 20px 0 10px;
}
.logo img {
  max-height: 80px;
}

/* --- Page Title --- */
h2 {
  text-align: center;
  font-size: 2.5rem;
  margin: 10px auto 40px;
  color: #333;
  padding-bottom: 10px;
  position: relative;
  width: fit-content;
}
h2::after {
  content: '';
  position: absolute;
  left: 0;
  bottom: 0;
  width: 100%;
  height: 4px;
  background-color: #A51C30;
  border-radius: 2px;
}

/* --- Carousel Container --- */
.carousel-container {
  position: relative;
  max-width: 1000px;
  margin: 0 auto;
  overflow: hidden;
}

/* Carousel Flexbox */
.carousel {
  display: flex;
  transition: transform 0.6s ease-in-out;
  touch-action: pan-x; /* enables horizontal swipe */
}

.carousel-item-wrapper {
  min-width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
}

.carousel-item {
  position: relative;
  width: 90%;
  height: 550px;
  overflow: hidden;
  border-radius: 15px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  transition: transform 0.8s ease-in-out;
}
.carousel-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transform: scale(0.85);
  transform-origin: center center;
  transition: transform 0.8s ease-in-out;
}

/* First image always full size */
.carousel-item-wrapper:first-child .carousel-item img {
  transform: scale(1);
}

/* Active slide scaling */
.carousel-item-wrapper.active:not(:first-child) .carousel-item img {
  transform: scale(1);
}

/* --- Caption --- */
.caption {
  position: absolute;
  bottom: -50px;
  left: 0;
  width: 100%;
  background: rgba(0,0,0,0.6);
  color: #fff;
  padding: 12px;
  font-weight: bold;
  font-size: 1.5rem;
  text-align: center;
  transition: bottom 0.8s ease-in-out;
}
.carousel-item-wrapper.active .caption {
  bottom: 0;
}

/* --- Navigation Buttons --- */
.nav-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 2.5rem;
  background-color: white;
  border: none;
  cursor: pointer;
  padding: 5px 15px;
  border-radius: 50%;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  transition: background 0.3s, transform 0.3s;
  z-index: 5;
}
.nav-btn.left { left: 5px; }
.nav-btn.right { right: 5px; }

/* --- Media Queries --- */
@media screen and (max-width: 992px) {
  .carousel-item {
    height: 450px;
  }
}

@media screen and (max-width: 768px) {
  body {
    background-size: 100% 100%; /* stretch background fully */
    background-position: top center;
    background-attachment: scroll;
  }
  .carousel-item {
    width: 95%;
    height: 350px;
    border-radius: 12px;
  }
  h2 {
    font-size: 2rem;
  }
  .nav-btn {
    font-size: 2rem;
    padding: 5px 10px;
  }
  .logo img {
    max-height: 60px;
  }
}

@media screen and (max-width: 600px) {
  .carousel-item {
    height: 300px;
  }
  .logo {
    margin-top: 80px; /* push below back button */
  }
}

  </style>
</head>
<body>
  <a href="{{ url_for('index') }}" class="back-btn">← Back to Home</a>
  <div class="logo">
    <img src="/static/images/csa logo.webp" alt="CSA School Logo">
  </div>
  <h2>CSA School Memories</h2>
  <div class="carousel-container">
    <button class="nav-btn left" onclick="prevSlide()">&#10094;</button>
    <div class="carousel" id="carousel">
      {% for image in album.images %}
      <div class="carousel-item-wrapper" id="album-{{ image.id }}">
        <div class="carousel-item">
          <img src="{{ image.image }}" alt="{{ image.caption }}">
          <div class="caption">{{ image.caption }}</div>
        </div>
      </div>
    {% endfor %}
    

    </div>
    
    <button class="nav-btn right" onclick="nextSlide()">&#10095;</button>
  </div>
  <script>
    const carousel = document.getElementById('carousel');
    const wrappers = document.querySelectorAll('.carousel-item-wrapper');
    let currentIndex = 0;

    function updateCarousel() {
      carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
      wrappers.forEach((w, i) => w.classList.toggle('active', i === currentIndex));
    }

    function nextSlide() {
      currentIndex = (currentIndex + 1) % wrappers.length;
      updateCarousel();
    }
    function prevSlide() {
      currentIndex = (currentIndex - 1 + wrappers.length) % wrappers.length;
      updateCarousel();
    }

    window.addEventListener('load', updateCarousel);
  </script>
</body>
<script>
fetch('/api/album')
  .then(res => res.json())
  .then(data => {
    const carousel = document.getElementById('carousel');
    if (!data || !Array.isArray(data.images)) {
      carousel.innerHTML = '<p style="color:red;text-align:center;">No images found</p>';
      return;
    }

    data.images.forEach((img, i) => {
      const wrapper = document.createElement('div');
      wrapper.className = 'carousel-item-wrapper';
      wrapper.id = `album-${img.id}`;

      const item = document.createElement('div');
      item.className = 'carousel-item';

      const image = document.createElement('img');
      image.src = img.image;
      image.alt = img.caption;

      const caption = document.createElement('div');
      caption.className = 'caption';
      caption.textContent = img.caption;

      item.appendChild(image);
      item.appendChild(caption);
      wrapper.appendChild(item);
      carousel.appendChild(wrapper);
    });

    // Re-initialize carousel functionality
    const wrappers = document.querySelectorAll('.carousel-item-wrapper');
    let currentIndex = 0;

    function updateCarousel() {
      carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
      wrappers.forEach((w, i) => w.classList.toggle('active', i === currentIndex));
    }

    function nextSlide() {
      currentIndex = (currentIndex + 1) % wrappers.length;
      updateCarousel();
    }

    function prevSlide() {
      currentIndex = (currentIndex - 1 + wrappers.length) % wrappers.length;
      updateCarousel();
    }

    window.updateCarousel = updateCarousel;
    window.nextSlide = nextSlide;
    window.prevSlide = prevSlide;

    updateCarousel();
  })
  .catch(err => {
    console.error('Error loading album data:', err);
  });
  // --- Swipe support ---
let startX = 0;
let endX = 0;

carousel.addEventListener('touchstart', (e) => {
  startX = e.touches[0].clientX;
});

carousel.addEventListener('touchmove', (e) => {
  endX = e.touches[0].clientX;
});

carousel.addEventListener('touchend', () => {
  const deltaX = endX - startX;
  if (Math.abs(deltaX) > 50) { // swipe threshold
    if (deltaX > 0) prevSlide();  // swipe right → previous
    else nextSlide();             // swipe left → next
  }
  startX = 0;
  endX = 0;
});

</script>

</html>
