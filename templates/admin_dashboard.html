<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CSA Admin Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f7f7f7; }
    .navbar { background: #a00000; color: white; padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; }
    .navbar h1 { margin: 0; font-size: 1.5rem; }
    .navbar a { color: white; background: rgba(255,255,255,0.2); padding: 8px 16px; text-decoration: none; border-radius: 5px; font-weight: bold; transition: 0.3s ease; }
    .navbar a:hover { background: rgba(255,255,255,0.4); }
    .dashboard { padding: 20px 30px; }
    .tabs { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 30px; }
    .tab-button { background: #ddd; border: none; padding: 10px 18px; border-radius: 8px; cursor: pointer; transition: all 0.2s ease; }
    .tab-button.active { background: #a00000; color: white; font-weight: bold; }
    .tab-button:hover { background: #c30000; color: white; }
    .section-box { display: none; background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    .section-box.active { display: block; }
    h2 { color: #a00000; margin-bottom: 12px; }
    label { display: block; margin-bottom: 6px; font-weight: bold; }
    input[type="text"], input[type="url"], textarea { width: 100%; padding: 8px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ccc; }
    .section-actions { margin-top: 15px; }
    button { padding: 8px 16px; background: #a00000; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; transition: background 0.3s; }
    button:hover { background: #7d0000; }
    .toast { position: fixed; bottom: 30px; right: 30px; background: #2ecc71; color: white; padding: 12px 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); display: none; z-index: 1000; }
    .image-preview { max-width: 200px; margin: 10px 0; }
    .section-title { font-size: 18px; font-weight: bold; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="navbar">
    <h1>CSA Admin Dashboard</h1>
    <a href="{{ url_for('admin_logout') }}">Logout</a>
  </div>
  <div class="dashboard">
    <p>Welcome Admin üëã | Edit each section below and click update.</p>
    <div class="tabs" id="tab-buttons"></div>
    <div class="sections" id="tab-sections">

    <!-- ABOUT SECTION START -->
    <div class="section-box active" id="tab-about_section">
      <h2>About Section</h2>
      <form method="POST" action="/admin/update/about_section">
        <label for="title">Title</label>
        <input type="text" name="title" value="{{ data['about_section']['title'] }}">

        <div class="section-title">Paragraphs</div>
        <div id="aboutParagraphsContainer">
          {% for p in data['about_section']['paragraphs'] %}
            <textarea name="paragraphs">{{ p }}</textarea>
          {% endfor %}
        </div>
        
        <div class="section-title">Carousel Images</div>
        <div id="aboutCarouselContainer">
          {% for img in data['about_section']['carousel_images'] %}
            <input type="url" name="carousel_images" value="{{ img }}">
          {% endfor %}
        </div>
        

        <div class="section-actions">
          <button type="submit">Update</button>
        </div>
      </form>
    </div>
    <!-- ABOUT SECTION END -->
    <!-- HEADS SECTION START -->
    <div class="section-box" id="tab-heads_section">
      <h2>Heads Section</h2>
      <form method="POST" action="/admin/update/heads_section" enctype="multipart/form-data">
        {% for head in data.heads_section.cards %}
        {% set idx = loop.index0 %}        
        <div class="card">
          <h3>Head #{{ idx + 1 }}</h3>
          <label>Name:<input type="text" name="name_{{ idx }}" value="{{ head.name }}"></label>
          <label>Role:<input type="text" name="role_{{ idx }}" value="{{ head.role }}"></label>
          <label>Popup Title:<input type="text" name="popup_title_{{ idx }}" value="{{ head.popup_title }}"></label>
          <label>Popup Text:<textarea name="popup_text_{{ idx }}">{{ head.popup_text }}</textarea></label>
          <label>Side:
            <select name="side_{{ idx }}">
              <option value="left" {% if head.side == 'left' %}selected{% endif %}>Left</option>
              <option value="middle" {% if head.side == 'middle' %}selected{% endif %}>Middle</option>
              <option value="right" {% if head.side == 'right' %}selected{% endif %}>Right</option>
            </select>
          </label>
          <label>Image Upload:<input type="file" name="image_{{ idx }}"></label>
          <img src="{{ head.image }}" alt="preview" style="max-width:150px;margin-top:8px;">
        </div>
        {% endfor %}
        <div class="section-actions">
          <button type="submit">Update All</button>
        </div>
      </form>
    </div>
    <!-- HEADS SECTION END -->
<!-- State Toppers Section -->
<div class="section-box" id="tab-state_toppers">
  <h2>State Toppers</h2>
  <form method="POST" action="/admin/update/state_toppers" enctype="multipart/form-data" id="stateToppersForm">
    <div id="stateToppersContainer">
      {% for topper in data.state_toppers %}
      {% set idx = loop.index0 %}      
      <div class="card topper-card" data-index="{{ idx }}">
        <h3>Topper #{{ idx + 1 }}</h3>
        <label>Name:<input type="text" name="name_{{ idx }}" value="{{ topper.name }}"></label>
        <label>Rank:<input type="text" name="rank_{{ idx }}" value="{{ topper.rank }}"></label>
        <label>Description:<textarea name="description_{{ idx }}">{{ topper.description }}</textarea></label>
        <label>Image Upload:<input type="file" name="image_{{ idx }}"></label>
        <img src="{{ topper.image }}" alt="preview" style="max-width:150px;margin-top:8px;">
        <button type="button" onclick="removeTopper(this)">‚ùå Remove</button>
      </div>
      {% endfor %}
    </div>
    <button type="button" onclick="addTopper()">‚ûï Add New Topper</button>
    <div class="section-actions">
      <button type="submit">Update All</button>
    </div>
  </form>
</div>
<!-- Subject Toppers Section -->
<div class="section-box" id="tab-subject_toppers">
  <h2>Subject Toppers</h2>
  <form method="POST" action="/admin/update/subject_toppers" enctype="multipart/form-data" id="subjectToppersForm">
    <div id="subjectToppersContainer">
      {% for year, item in data.subject_toppers.items() %}
      <div class="card subject-topper-card" data-year="{{ year }}">
        <h3>Year: <input type="text" name="year_{{ loop.index0 }}" value="{{ year }}"></h3>
        <label>Title:<input type="text" name="title_{{ loop.index0 }}" value="{{ item.title }}"></label>
        <label>Image Upload:<input type="file" name="image_{{ loop.index0 }}"></label>
        <img src="{{ item.image }}" alt="preview" style="max-width:150px;margin-top:8px;">
        <button type="button" onclick="removeSubjectTopper(this)">‚ùå Remove</button>
      </div>
      {% endfor %}
    </div>
    <button type="button" onclick="addSubjectTopper()">‚ûï Add New Year</button>
    <div class="section-actions">
      <button type="submit">Update All</button>
    </div>
  </form>
</div>
<!-- Ad Section -->
<div class="section-box" id="tab-ad_section">
  <h2>Ad Section</h2>
  <form method="POST" action="/admin/update/ad_section" enctype="multipart/form-data">
    <div class="card">
      <label>Left Image:
        <input type="file" name="left_image">
      </label>
      <img src="{{ data.ad_section.left_image }}" alt="Left Ad" style="max-width:150px;margin-top:8px;">
    </div>

    <div class="card">
      <label>Right Image:
        <input type="file" name="right_image">
      </label>
      <img src="{{ data.ad_section.right_image }}" alt="Right Ad" style="max-width:150px;margin-top:8px;">
    </div>

    <div class="section-actions">
      <button type="submit">Update</button>
    </div>
  </form>
</div>
<!-- Faculties Section -->
<div class="section-box" id="tab-faculties_section">
  <h2>Faculties Section</h2>
  <div class="faculty-admin-grid">
    <!-- Left Side: Search and List -->
    <div class="faculty-list">
      <input type="text" id="searchFaculty" placeholder="Search by name or subject" oninput="filterFaculties()">
      <ul id="facultyList">
        {% for faculty in data.faculties_section %}
          <li onclick="selectFaculty('{{ faculty.id }}')" data-id="{{ faculty.id }}">
            {{ faculty.name }} ‚Äì {{ faculty.subject }}
          </li>
        {% endfor %}
      </ul>
    </div>

    <!-- Right Side: Edit Form -->
    <div class="faculty-edit" id="facultyEditPanel">
      <h3>Edit Faculty</h3>
      <form method="POST" action="/admin/update/faculty_edit" enctype="multipart/form-data">
        <input type="hidden" name="id" id="faculty_id">
        <label>Name: <input type="text" name="name" id="faculty_name"></label>
        <label>Subject: <input type="text" name="subject" id="faculty_subject"></label>
        <label>Qualification: <input type="text" name="qualification" id="faculty_qualification"></label>
        <label>Image Upload: <input type="file" name="image"></label>
        <img id="faculty_image_preview" src="#" style="max-width: 150px; margin-top: 8px; display: none;">
        <div class="section-actions">
          <button type="submit">Save Changes</button>
          <button type="button" onclick="deleteFaculty()">‚ùå Remove</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add New Faculty -->
  <div class="card">
    <h3>Add New Faculty</h3>
    <form method="POST" action="/admin/update/faculty_add" enctype="multipart/form-data">
      <label>Name: <input type="text" name="name"></label>
      <label>Subject: <input type="text" name="subject"></label>
      <label>Qualification: <input type="text" name="qualification"></label>
      <label>Image Upload: <input type="file" name="image"></label>
      <div class="section-actions">
        <button type="submit">‚ûï Add Faculty</button>
      </div>
    </form>
  </div>
</div>

<style>
  .faculty-admin-grid {
    display: flex;
    gap: 2rem;
  }
  .faculty-list {
    flex: 1;
    max-height: 500px;
    overflow-y: auto;
    border-right: 1px solid #ccc;
    padding-right: 1rem;
  }
  .faculty-list ul {
    list-style: none;
    padding: 0;
  }
  .faculty-list li {
    cursor: pointer;
    padding: 0.5rem;
    border-bottom: 1px solid #eee;
  }
  .faculty-list li:hover {
    background: #f0f0f0;
  }
  .faculty-edit {
    flex: 2;
  }
</style>
<!-- Album Section -->
<div class="section-box" id="tab-album">
  <h2>Album Section</h2>
  <form method="POST" action="/admin/update/album" enctype="multipart/form-data" id="albumForm">
    <div id="albumContainer">
      {% for photo in data.album %}
      {% set idx = loop.index0 %}
      
      <div class="card" data-index="{{ idx }}">
        <h3>Album Image #{{ idx + 1 }}</h3>
        <label>Caption:
          <input type="text" name="caption_{{ idx }}" value="{{ photo.caption }}">
        </label>
        <label>Image Upload:
          <input type="file" name="image_{{ idx }}">
        </label>
        <img src="{{ photo.image }}" alt="preview" style="max-width:150px;margin-top:8px;">
        <button type="button" onclick="removeAlbumItem(this)">‚ùå Remove</button>
      </div>
      {% endfor %}
    </div>
    <button type="button" onclick="addAlbumItem()">‚ûï Add New Album Photo</button>
    <div class="section-actions">
      <button type="submit">Update All</button>
    </div>
  </form>
</div>
<!-- Admission Rules Section -->
<div class="section-box" id="tab-admission_section">
  <h2>Admission Rules</h2>
  <form method="POST" action="/admin/update/admission_section" enctype="multipart/form-data" id="admissionRulesForm">
    <div id="admissionRulesContainer">
      {% for rule in data.admission_section.rules %}
      {% set idx = loop.index0 %}
      
      <div class="card" data-index="{{ idx }}">
        <label>Rule #{{ idx + 1 }}:
          <textarea name="rule_{{ idx }}">{{ rule }}</textarea>
        </label>
        <button type="button" onclick="removeAdmissionRule(this)">‚ùå Remove</button>
      </div>
      {% endfor %}
    </div>
    <button type="button" onclick="addAdmissionRule()">‚ûï Add New Rule</button>
    <div class="section-actions">
      <button type="submit">Update All</button>
    </div>
  </form>
</div>

<!-- Hostel Carousel Images Section -->
<div class="section-box" id="tab-hostel_carousel_images">
  <h2>Hostel Carousel Images</h2>
  <form method="POST" action="/admin/update/hostel_carousel_images" enctype="multipart/form-data" id="hostelCarouselForm">
    <div id="hostelCarouselContainer">
      {% for image in data.hostel_carousel_images %}
      {% set idx = loop.index0 %}
      
      <div class="card" data-index="{{ idx }}">
        <p><strong>Image #{{ idx + 1 }}</strong></p>
        <img src="{{ image }}" alt="Hostel Image" class="image-preview" />
        <label>Replace Image:
          <input type="file" name="image_{{ idx }}">
        </label>
        <button type="button" onclick="removeHostelImage(this)">‚ùå Remove</button>
      </div>
      {% endfor %}
    </div>
    <button type="button" onclick="addHostelImage()">‚ûï Add New Image</button>
    <div class="section-actions">
      <button type="submit">Update All</button>
    </div>
  </form>
</div>
 <!-- Layout Section -->
 <div class="section-box" id="tab-layout">
  <h2>Footer Layout & Contact Info</h2>
  <form method="POST" action="/admin/update/layout" enctype="multipart/form-data">
    <div class="card">
      <h3>üì± Social Media Links</h3>
      <label>Facebook:
        <input type="url" name="social_facebook" value="{{ data.layout.footer.social_links.facebook }}">
      </label>
      <label>Twitter:
        <input type="url" name="social_twitter" value="{{ data.layout.footer.social_links.twitter }}">
      </label>
      <label>Instagram:
        <input type="url" name="social_instagram" value="{{ data.layout.footer.social_links.instagram }}">
      </label>
    </div>

    <div class="card">
      <h3>üìû Contact Info</h3>
      <label>Email:
        <input type="email" name="contact_email" value="{{ data.layout.footer.contact_email }}">
      </label>
      <label>Phone:
        <input type="text" name="contact_phone" value="{{ data.layout.footer.contact_phone }}">
      </label>
      <label>Address:
        <textarea name="contact_address">{{ data.layout.footer.contact_address }}</textarea>
      </label>
    </div>

    <div class="card">
      <h3>¬© Copyright</h3>
      <textarea name="copyright">{{ data.layout.footer.copyright }}</textarea>
    </div>

    <div class="section-actions">
      <button type="submit">Update Footer</button>
    </div>
  </form>
</div>
<!-- MAP SECTION -->
<div class="section-box" id="tab-map_section">
  <h2>Map Section</h2>
  <form method="POST" action="/admin/update/map_section">
    <label for="map_title">Map Title:</label>
    <input type="text" name="map_title" value="{{ data.map_section.title }}">

    <label for="iframe_src">Google Maps Embed URL:</label>
    <input type="url" name="iframe_src" value="{{ data.map_section.iframe_src }}">

    <div class="section-actions">
      <button type="submit">Update Map</button>
    </div>
  </form>
</div>

  </div>
</div>
<div class="toast" id="toast">‚úÖ Updated Successfully</div>
<script>
  const sections = [
    "about_section",
    "heads_section",
    "state_toppers",
    "subject_toppers",
    "ad_section",
    "map_section",
    "layout",
    "faculties_section",
    "album",
    "admission_section",
    "hostel_carousel_images",
    "hostel_features"
  ];

  function showTab(tabId) {
    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.section-box').forEach(box => box.classList.remove('active'));
    document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
    document.getElementById(`tab-${tabId}`).classList.add('active');
  }

  function createTabs() {
    const tabButtons = document.getElementById("tab-buttons");
    sections.forEach((section, i) => {
      const btn = document.createElement("button");
      btn.className = "tab-button" + (i === 0 ? " active" : "");
      btn.setAttribute("data-tab", section);
      btn.onclick = () => showTab(section);
      btn.innerText = section.replace(/_/g, " ").replace(/\b\w/g, c => c.toUpperCase());
      tabButtons.appendChild(btn);
    });
  }

  window.onload = function () {
    createTabs();
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('updated') === 'true') {
      const toast = document.getElementById("toast");
      toast.style.display = "block";
      setTimeout(() => toast.style.display = "none", 3000);
    }
  };
  
</script>
<script>
let topperCount = parseInt("{{ data.state_toppers | length | default(0, true) }}");
  function addTopper() {
    const container = document.getElementById('stateToppersForm').querySelector('form');
    const card = document.createElement('div');
    card.className = 'card topper-card';
    card.innerHTML = `
      <h3>Topper #${topperCount + 1}</h3>
      <label>Name:<input type="text" name="name_${topperCount}" value=""></label>
      <label>Rank:<input type="text" name="rank_${topperCount}" value=""></label>
      <label>Description:<textarea name="description_${topperCount}"></textarea></label>
      <label>Image Upload:<input type="file" name="image_${topperCount}"></label>
      <button type="button" onclick="removeTopper(this)">‚ùå Remove</button>
    `;
    container.insertBefore(card, container.querySelector('.section-actions'));
    topperCount++;
  }

  function removeTopper(button) {
    const card = button.closest('.card');
    if (card) card.remove();
let subjectTopperCount = parseInt("{{ data.subject_toppers | length | default(0, true) }}");
function addSubjectTopper() {
  const container = document.getElementById('subjectToppersContainer');
  const card = document.createElement('div');
  card.className = 'card subject-topper-card';
  card.innerHTML = `
    <h3>Year: <input type="text" name="year_${subjectTopperCount}" value=""></h3>
    <label>Title:<input type="text" name="title_${subjectTopperCount}" value=""></label>
    <label>Image Upload:<input type="file" name="image_${subjectTopperCount}"></label>
    <button type="button" onclick="removeSubjectTopper(this)">‚ùå Remove</button>
  `;
  container.appendChild(card);
  subjectTopperCount++;
}

function removeSubjectTopper(button) {
  const card = button.closest('.card');
  if (card) card.remove();
}


</script>
<script type="text/javascript">

  const faculties = {{ data.faculties_section | tojson | safe }};
  function filterFaculties() {
    const input = document.getElementById('searchFaculty').value.toLowerCase();
    const items = document.querySelectorAll('#facultyList li');
    items.forEach(li => {
      const text = li.textContent.toLowerCase();
      li.style.display = text.includes(input) ? '' : 'none';
    });
  }

  function selectFaculty(id) {
    const faculty = faculties.find(f => f.id === id);
    if (!faculty) return;

    document.getElementById('faculty_id').value = faculty.id;
    document.getElementById('faculty_name').value = faculty.name;
    document.getElementById('faculty_subject').value = faculty.subject;
    document.getElementById('faculty_qualification').value = faculty.qualification;

    const preview = document.getElementById('faculty_image_preview');
    if (faculty.image) {
      preview.src = faculty.image;
      preview.style.display = 'block';
    } else {
      preview.style.display = 'none';
    }
  }

  function deleteFaculty() {
    const id = document.getElementById('faculty_id').value;
    if (!id) return;
    if (confirm("Are you sure you want to delete this faculty?")) {
      fetch(`/admin/delete/faculty/${id}`, {
        method: 'POST'
      }).then(() => window.location.reload());
    }
  }
</script>



<script>
let albumCount = parseInt("{{ data.album | length | default(0, true) }}");
function addAlbumItem() {
  const container = document.getElementById('albumContainer');
  const card = document.createElement('div');
  card.className = 'card';
  card.setAttribute('data-index', albumCount);
  card.innerHTML = `
    <h3>Album Image #${albumCount + 1}</h3>
    <label>Caption:<input type="text" name="caption_${albumCount}" value=""></label>
    <label>Image Upload:<input type="file" name="image_${albumCount}"></label>
    <button type="button" onclick="removeAlbumItem(this)">‚ùå Remove</button>
  `;
  container.appendChild(card);
  albumCount++;
}
function removeAlbumItem(button) {
  const card = button.closest('.card');
  card.remove();
}
</script>

<script>
  let admissionRuleCount = parseInt("{{ data.admission_section.rules | length | default(0, true) }}");

  function addAdmissionRule() {
    const container = document.getElementById('admissionRulesContainer');
    const card = document.createElement('div');
    card.className = 'card';
    card.setAttribute('data-index', admissionRuleCount);
    card.innerHTML = `
      <label>Rule #${admissionRuleCount + 1}:<textarea name="rule_${admissionRuleCount}"></textarea></label>
      <button type="button" onclick="removeAdmissionRule(this)">‚ùå Remove</button>
    `;
    container.appendChild(card);
    admissionRuleCount++;
  }

  function removeAdmissionRule(button) {
    const card = button.closest('.card');
    card.remove();
  }

  let hostelImageCount = parseInt("{{ data.hostel_carousel_images | length | default(0, true) }}");

  function addHostelImage() {
    const container = document.getElementById('hostelCarouselContainer');
    const card = document.createElement('div');
    card.className = 'card';
    card.setAttribute('data-index', hostelImageCount);
    card.innerHTML = `
      <p><strong>Image #${hostelImageCount + 1}</strong></p>
      <label>Upload Image: <input type="file" name="image_${hostelImageCount}"></label>
      <button type="button" onclick="removeHostelImage(this)">‚ùå Remove</button>
    `;
    container.appendChild(card);
    hostelImageCount++;
  }

  function removeHostelImage(button) {
    const card = button.closest('.card');
    card.remove();
  }
</script>

<script>
  let aboutParagraphCount = parseInt("{{ data.about_section.paragraphs | length | default(0, true) }}");
  function addAboutParagraph() {
    const container = document.getElementById('aboutParagraphsContainer');
    const card = document.createElement('div');
    card.className = 'card';
    card.setAttribute('data-index', aboutParagraphCount);
    card.innerHTML = `
      <label>Paragraph #${aboutParagraphCount + 1}:<textarea name="paragraph_${aboutParagraphCount}"></textarea></label>
      <button type="button" onclick="removeAboutParagraph(this)">‚ùå Remove</button>
    `;
    container.appendChild(card);
    aboutParagraphCount++;
  }

  function removeAboutParagraph(button) {
    const card = button.closest('.card');
    card.remove();
  }

  let aboutImageCount = parseInt("{{ data.about_section.carousel_images | length | default(0, true) }}");
  function addAboutImage() {
    const container = document.getElementById('aboutCarouselContainer');
    const card = document.createElement('div');
    card.className = 'card';
    card.setAttribute('data-index', aboutImageCount);
    card.innerHTML = `
      <p><strong>Image #${aboutImageCount + 1}</strong></p>
      <label>Image URL: <input type="url" name="carousel_image_${aboutImageCount}"></label>
      <button type="button" onclick="removeAboutImage(this)">‚ùå Remove</button>
    `;
    container.appendChild(card);
    aboutImageCount++;
  }

  function removeAboutImage(button) {
    const card = button.closest('.card');
    card.remove();
  }
</script>
</body>
</html>
